<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Journal - –≠–ª–µ–∫—Ç—Ä–æ–Ω–Ω—ã–π –∂—É—Ä–Ω–∞–ª –ø–æ—Å–µ—â–∞–µ–º–æ—Å—Ç–∏</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #2c3e50;
            --secondary: #34495e;
            --success: #27ae60;
            --danger: #e74c3c;
            --warning: #f39c12;
            --light: #ecf0f1;
            --dark: #2c3e50;
            --gray: #7f8c8d;
            --border: #bdc3c7;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f6fa;
            min-height: 100vh;
            padding: 20px;
            color: var(--dark);
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        /* Header */
        header {
            background: var(--primary);
            color: white;
            padding: 20px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--border);
        }

        .header-left h1 {
            font-size: 24px;
            margin-bottom: 5px;
            font-weight: 600;
        }

        .header-left p {
            opacity: 0.8;
            font-size: 14px;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
            background: rgba(255,255,255,0.1);
            padding: 10px 15px;
            border-radius: 8px;
        }

        .user-role {
            background: var(--success);
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
        }

        .btn {
            padding: 8px 16px;
            border: 1px solid var(--border);
            border-radius: 6px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s ease;
            background: white;
        }

        .btn-logout {
            background: transparent;
            color: white;
            border-color: rgba(255,255,255,0.3);
        }

        .btn-logout:hover {
            background: rgba(255,255,255,0.1);
        }

        .btn-primary {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .btn-warning {
            background: var(--warning);
            color: white;
            border-color: var(--warning);
        }

        .btn-success {
            background: var(--success);
            color: white;
            border-color: var(--success);
        }

        .btn-danger {
            background: var(--danger);
            color: white;
            border-color: var(--danger);
        }

        /* Tabs */
        .tabs {
            display: flex;
            background: var(--light);
            border-bottom: 1px solid var(--border);
        }

        .tab {
            padding: 15px 30px;
            background: transparent;
            color: var(--gray);
            border: none;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 14px;
            border-bottom: 2px solid transparent;
        }

        .tab:hover {
            color: var(--primary);
            background: white;
        }

        .tab.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
            background: white;
            font-weight: 500;
        }

        .tab-content {
            display: none;
            padding: 25px;
        }

        .tab-content.active {
            display: block;
        }

        /* Calendar */
        .calendar-section {
            background: white;
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border);
        }

        .current-date {
            font-size: 18px;
            font-weight: 600;
            color: var(--dark);
        }

        .calendar-nav {
            display: flex;
            gap: 10px;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 1px;
            background: var(--border);
            border: 1px solid var(--border);
        }

        .calendar-day-header {
            padding: 12px 8px;
            text-align: center;
            font-weight: 600;
            color: var(--dark);
            font-size: 12px;
            background: var(--light);
        }

        .calendar-day {
            padding: 12px 8px;
            text-align: center;
            background: white;
            cursor: pointer;
            transition: all 0.2s ease;
            border: none;
            font-size: 14px;
            position: relative;
            min-height: 60px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .calendar-day:hover {
            background: #e3f2fd;
        }

        .calendar-day.selected {
            background: var(--primary);
            color: white;
        }

        .calendar-day.today {
            background: #fff3cd;
            font-weight: 600;
        }

        .calendar-day.weekend {
            background: #f8f9fa;
            color: var(--danger);
        }

        .calendar-day.has-data::after {
            content: '';
            position: absolute;
            bottom: 4px;
            left: 50%;
            transform: translateX(-50%);
            width: 6px;
            height: 6px;
            background: var(--success);
            border-radius: 50%;
        }

        .calendar-day.absent-data::after {
            background: var(--danger);
        }

        .calendar-day.readonly {
            background: #f8f9fa;
            color: var(--gray);
            cursor: not-allowed;
        }

        .calendar-day.readonly:hover {
            background: #f8f9fa;
        }

        .day-number {
            font-size: 16px;
            font-weight: 600;
        }

        .day-stats {
            font-size: 10px;
            margin-top: 2px;
            opacity: 0.7;
        }

        /* Filters */
        .filters {
            display: grid;
            grid-template-columns: 1fr auto;
            gap: 15px;
            margin-bottom: 20px;
            align-items: end;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
        }

        .filter-group label {
            margin-bottom: 5px;
            font-weight: 600;
            color: var(--dark);
            font-size: 14px;
        }

        .filter-select {
            padding: 10px 12px;
            border: 1px solid var(--border);
            border-radius: 6px;
            font-size: 14px;
            background: white;
        }

        /* Students Grid */
        .students-container {
            max-height: 600px;
            overflow-y: auto;
            border: 1px solid var(--border);
            border-radius: 8px;
        }

        .students-grid {
            display: grid;
            gap: 1px;
            background: var(--border);
        }

        .student-row {
            display: grid;
            grid-template-columns: 1fr auto;
            background: white;
            padding: 12px 15px;
            align-items: center;
        }

        .student-row:nth-child(even) {
            background: #f8f9fa;
        }

        .student-info h3 {
            font-size: 14px;
            margin-bottom: 2px;
            font-weight: 600;
        }

        .student-info p {
            color: var(--gray);
            font-size: 12px;
        }

        .attendance-controls {
            display: flex;
            gap: 8px;
        }

        .attendance-btn {
            padding: 6px 12px;
            border: 1px solid var(--border);
            border-radius: 4px;
            background: white;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 12px;
        }

        .attendance-btn.active {
            font-weight: 600;
        }

        .attendance-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-present {
            border-color: var(--success);
            color: var(--success);
        }

        .btn-present.active {
            background: var(--success);
            color: white;
        }

        .btn-absent {
            border-color: var(--danger);
            color: var(--danger);
        }

        .btn-absent.active {
            background: var(--danger);
            color: white;
        }

        /* Weekly Report */
        .week-report {
            border: 1px solid var(--border);
            border-radius: 8px;
            overflow: hidden;
        }

        .week-report-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border);
        }

        .week-nav {
            display: flex;
            gap: 10px;
        }

        .current-week {
            font-size: 16px;
            font-weight: 600;
            color: var(--dark);
        }

        .report-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 12px;
        }

        .report-table th {
            background: var(--light);
            padding: 12px 8px;
            text-align: center;
            font-weight: 600;
            color: var(--dark);
            border: 1px solid var(--border);
            font-size: 11px;
        }

        .report-table td {
            padding: 8px 6px;
            text-align: center;
            border: 1px solid var(--border);
            font-size: 11px;
        }

        .student-name {
            text-align: left;
            font-weight: 600;
            background: var(--light);
            padding: 8px 12px;
            min-width: 180px;
        }

        .present-cell {
            background: #d4edda;
            color: #155724;
        }

        .absent-cell {
            background: #f8d7da;
            color: #721c24;
        }

        .total-cell {
            background: var(--primary);
            color: white;
            font-weight: 600;
        }

        /* Notifications */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 12px 16px;
            border-radius: 6px;
            color: white;
            font-weight: 500;
            z-index: 1000;
            transform: translateX(400px);
            transition: transform 0.3s ease;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.success {
            background: var(--success);
        }

        .notification.error {
            background: var(--danger);
        }

        .notification.warning {
            background: var(--warning);
        }

        /* Save Button */
        .save-section {
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid var(--border);
            text-align: center;
        }

        .loading {
            opacity: 0.6;
            pointer-events: none;
        }

        /* Online Status */
        .online-status {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 10px;
            font-size: 12px;
        }
        
        .status-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--success);
        }
        
        .status-indicator.offline {
            background: var(--danger);
        }
        
        /* Add Student Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        
        .modal-overlay.show {
            opacity: 1;
            visibility: visible;
        }
        
        .modal {
            background: white;
            border-radius: 8px;
            padding: 25px;
            width: 90%;
            max-width: 600px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            transform: translateY(-20px);
            transition: transform 0.3s ease;
        }
        
        .modal-overlay.show .modal {
            transform: translateY(0);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border);
        }
        
        .modal-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--dark);
        }
        
        .modal-close {
            background: none;
            border: none;
            font-size: 20px;
            cursor: pointer;
            color: var(--gray);
        }
        
        .modal-body {
            margin-bottom: 20px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: var(--dark);
            font-size: 14px;
        }
        
        .form-control {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid var(--border);
            border-radius: 6px;
            font-size: 14px;
        }
        
        textarea.form-control {
            min-height: 120px;
            resize: vertical;
        }
        
        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            padding-top: 15px;
            border-top: 1px solid var(--border);
        }
        
        /* Add Student Button */
        .add-student-section {
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid var(--border);
            text-align: center;
        }
        
        .add-student-btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: var(--success);
            color: white;
            border: none;
            padding: 10px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s ease;
        }
        
        .add-student-btn:hover {
            background: #219653;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –∫–∞—Ä—Ç–æ—á–µ–∫ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ –≤ –Ω–æ–≤–æ–º –¥–∏–∑–∞–π–Ω–µ */
        .student-card {
            background: white;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            padding: 15px;
            margin-bottom: 10px;
            border-left: 4px solid var(--primary);
        }

        .student-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 10px;
        }

        .student-name {
            font-size: 16px;
            font-weight: 600;
            color: var(--dark);
            margin-bottom: 5px;
        }

        .student-details {
            color: var(--gray);
            font-size: 12px;
        }

        .attendance-status {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
        }

        .status-present {
            background: rgba(39, 174, 96, 0.1);
            color: var(--success);
            border: 1px solid rgba(39, 174, 96, 0.3);
        }

        .status-absent {
            background: rgba(231, 76, 60, 0.1);
            color: var(--danger);
            border: 1px solid rgba(231, 76, 60, 0.3);
        }

        .status-unknown {
            background: rgba(127, 140, 141, 0.1);
            color: var(--gray);
            border: 1px solid rgba(127, 140, 141, 0.3);
        }

        .card-attendance-controls {
            display: flex;
            gap: 8px;
            margin-top: 10px;
        }

        .card-btn {
            padding: 6px 12px;
            border: 1px solid var(--border);
            border-radius: 4px;
            background: white;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 12px;
            flex: 1;
        }

        .card-btn-present {
            border-color: var(--success);
            color: var(--success);
        }

        .card-btn-present:hover, .card-btn-present.active {
            background: var(--success);
            color: white;
        }

        .card-btn-absent {
            border-color: var(--danger);
            color: var(--danger);
        }

        .card-btn-absent:hover, .card-btn-absent.active {
            background: var(--danger);
            color: white;
        }

        .card-btn:disabled {
            background: #f8f9fa;
            color: var(--gray);
            border-color: var(--border);
            cursor: not-allowed;
        }

        .card-btn:disabled:hover {
            background: #f8f9fa;
            color: var(--gray);
        }

        /* –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: white;
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 15px;
            text-align: center;
        }

        .stat-value {
            font-size: 24px;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 12px;
            color: var(--gray);
            font-weight: 500;
        }

        /* Group Selector */
        .group-selector {
            background: white;
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .group-filters {
            display: grid;
            grid-template-columns: 1fr auto;
            gap: 15px;
            align-items: end;
        }

        /* Students Grid Layout */
        .students-grid-cards {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 15px;
            padding: 15px;
        }

        /* Batch Add Students */
        .batch-add-section {
            background: white;
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .batch-controls {
            display: grid;
            grid-template-columns: 1fr auto;
            gap: 15px;
            align-items: end;
            margin-bottom: 15px;
        }

        .students-preview {
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid var(--border);
            border-radius: 6px;
            padding: 10px;
            background: #f8f9fa;
            margin-bottom: 15px;
        }

        .student-preview-item {
            padding: 5px 0;
            border-bottom: 1px solid #e9ecef;
            font-size: 12px;
        }

        .student-preview-item:last-child {
            border-bottom: none;
        }

        /* –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –ø–æ—á–∞—Å–æ–≤–æ–≥–æ —É—á–µ—Ç–∞ */
        .hourly-controls {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 5px;
            margin-top: 10px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 6px;
            border: 1px solid var(--border);
        }
        
        .hour-label {
            font-size: 10px;
            text-align: center;
            margin-bottom: 5px;
            color: var(--gray);
            font-weight: 600;
        }
        
        .hour-btn {
            padding: 4px 6px;
            border: 1px solid var(--border);
            border-radius: 4px;
            background: white;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 10px;
            min-height: 24px;
        }
        
        .hour-btn.present {
            background: var(--success);
            color: white;
            border-color: var(--success);
        }
        
        .hour-btn.absent {
            background: var(--danger);
            color: white;
            border-color: var(--danger);
        }
        
        .hour-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .hour-summary {
            font-size: 11px;
            margin-top: 8px;
            text-align: center;
            color: var(--dark);
            font-weight: 600;
        }
        
        .hourly-stats {
            display: flex;
            justify-content: space-between;
            margin-top: 5px;
        }
        
        .hours-present {
            color: var(--success);
        }
        
        .hours-absent {
            color: var(--danger);
        }
        
        /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
        @media (max-width: 768px) {
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .filters {
                grid-template-columns: 1fr;
            }
            
            .student-row {
                grid-template-columns: 1fr;
                gap: 10px;
            }
            
            .group-filters {
                grid-template-columns: 1fr;
            }
            
            .batch-controls {
                grid-template-columns: 1fr;
            }
            
            .students-grid-cards {
                grid-template-columns: 1fr;
            }
            
            .hourly-controls {
                grid-template-columns: repeat(3, 1fr);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="header-left">
                <h1>üìí –ñ—É—Ä–Ω–∞–ª –ø–æ—Å–µ—â–∞–µ–º–æ—Å—Ç–∏</h1>
                <p>–°–∏—Å—Ç–µ–º–∞ —É—á–µ—Ç–∞ –ø–æ—Å–µ—â–µ–Ω–∏–π —Å—Ç—É–¥–µ–Ω—Ç–æ–≤</p>
                <div class="online-status">
                    <div class="status-indicator" id="statusIndicator"></div>
                    <span id="statusText">–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è...</span>
                </div>
            </div>
            <div class="user-info">
                <span id="userName">–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä —Å–∏—Å—Ç–µ–º—ã</span>
                <span class="user-role" id="userRole">–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä</span>
                <button class="btn btn-logout" id="logoutBtn">–í—ã–π—Ç–∏</button>
            </div>
        </header>

        <div class="tabs">
            <button class="tab active" data-page="daily">üìÖ –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π —É—á–µ—Ç</button>
            <button class="tab" data-page="weekly">üìä –ù–µ–¥–µ–ª—å–Ω—ã–π –æ—Ç—á–µ—Ç</button>
            <button class="tab" data-page="students">üë• –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ç—É–¥–µ–Ω—Ç–∞–º–∏</button>
        </div>

        <!-- –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π —É—á–µ—Ç -->
        <div id="dailyPage" class="tab-content active">
            <div class="calendar-section">
                <div class="calendar-header">
                    <div class="current-date" id="currentDate"></div>
                    <div class="calendar-nav">
                        <button class="btn" id="prevMonth">‚óÄ –ü—Ä–µ–¥—ã–¥—É—â–∏–π</button>
                        <button class="btn btn-primary" id="todayBtn">–°–µ–≥–æ–¥–Ω—è</button>
                        <button class="btn" id="nextMonth">–°–ª–µ–¥—É—é—â–∏–π ‚ñ∂</button>
                    </div>
                </div>
                <div class="calendar-grid" id="calendarGrid"></div>
            </div>

            <div class="group-selector">
                <div class="group-filters">
                    <div class="filter-group">
                        <label>–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ—Ñ–µ—Å—Å–∏—é:</label>
                        <select class="filter-select" id="professionSelect">
                            <option value="">–í—Å–µ –ø—Ä–æ—Ñ–µ—Å—Å–∏–∏</option>
                            <!-- –ü—Ä–æ—Ñ–µ—Å—Å–∏–∏ –±—É–¥—É—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω—ã —á–µ—Ä–µ–∑ JavaScript -->
                        </select>
                    </div>
                    <div>
                        <button class="btn btn-primary" id="applyFilterBtn">–ü—Ä–∏–º–µ–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä</button>
                    </div>
                </div>
            </div>

            <div class="filters">
                <div class="filter-group">
                    <label>–î–∞—Ç–∞: <span id="selectedDateDisplay"></span></label>
                </div>
                <div id="editModeContainer">
                    <button class="btn btn-warning" id="editModeBtn">
                        ‚úèÔ∏è –†–µ–∂–∏–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
                    </button>
                </div>
            </div>

            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value" id="dailyTotalStudents">0</div>
                    <div class="stat-label">–í—Å–µ–≥–æ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="dailyPresent">0</div>
                    <div class="stat-label">–ü—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="dailyAbsent">0</div>
                    <div class="stat-label">–û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="dailyAttendance">0%</div>
                    <div class="stat-label">–ü–æ—Å–µ—â–∞–µ–º–æ—Å—Ç—å</div>
                </div>
            </div>

            <div class="save-section" id="saveSection">
                <button class="btn btn-success" id="saveAttendanceBtn">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø–æ—Å–µ—â–∞–µ–º–æ—Å—Ç—å</button>
            </div>

            <div class="students-container">
                <div class="students-grid-cards" id="studentsGrid">
                    <!-- –°–ø–∏—Å–æ–∫ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ –±—É–¥–µ—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω —á–µ—Ä–µ–∑ JavaScript -->
                </div>
            </div>
        </div>

        <!-- –ù–µ–¥–µ–ª—å–Ω—ã–π –æ—Ç—á–µ—Ç -->
        <div id="weeklyPage" class="tab-content">
            <div class="week-report-header">
                <div class="current-week" id="currentWeekRange"></div>
                <div class="week-nav">
                    <button class="btn" id="prevWeek">‚óÄ –ü—Ä–µ–¥—ã–¥—É—â–∞—è</button>
                    <button class="btn" id="nextWeek">–°–ª–µ–¥—É—é—â–∞—è ‚ñ∂</button>
                </div>
            </div>

            <div class="group-selector">
                <div class="group-filters">
                    <div class="filter-group">
                        <label>–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ—Ñ–µ—Å—Å–∏—é:</label>
                        <select class="filter-select" id="weeklyProfessionSelect">
                            <option value="">–í—Å–µ –ø—Ä–æ—Ñ–µ—Å—Å–∏–∏</option>
                            <!-- –ü—Ä–æ—Ñ–µ—Å—Å–∏–∏ –±—É–¥—É—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω—ã —á–µ—Ä–µ–∑ JavaScript -->
                        </select>
                    </div>
                    <div>
                        <button class="btn btn-primary" id="weeklyApplyFilterBtn">–ü—Ä–∏–º–µ–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä</button>
                    </div>
                </div>
            </div>

            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value" id="weeklyTotalStudents">0</div>
                    <div class="stat-label">–í—Å–µ–≥–æ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="weeklyAvgAttendance">0%</div>
                    <div class="stat-label">–°—Ä–µ–¥–Ω—è—è –ø–æ—Å–µ—â–∞–µ–º–æ—Å—Ç—å</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="weeklyTotalPresent">0</div>
                    <div class="stat-label">–í—Å–µ–≥–æ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª–æ</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="weeklyTotalAbsent">0</div>
                    <div class="stat-label">–í—Å–µ–≥–æ –æ—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª–æ</div>
                </div>
            </div>

            <div class="week-report">
                <div id="weeklyTableContainer">
                    <table class="report-table">
                        <thead>
                            <tr>
                                <th>–°—Ç—É–¥–µ–Ω—Ç</th>
                                <th>–ü–Ω</th>
                                <th>–í—Ç</th>
                                <th>–°—Ä</th>
                                <th>–ß—Ç</th>
                                <th>–ü—Ç</th>
                                <th>–°–±</th>
                                <th>–í—Å–µ–≥–æ</th>
                                <th>–ü–æ—Å–µ—â–µ–Ω–æ</th>
                                <th>–ü—Ä–æ–ø—É—â–µ–Ω–æ</th>
                            </tr>
                        </thead>
                        <tbody id="weeklyTableBody">
                            <!-- –¢–∞–±–ª–∏—Ü–∞ –±—É–¥–µ—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω–∞ —á–µ—Ä–µ–∑ JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ç—É–¥–µ–Ω—Ç–∞–º–∏ -->
        <div id="studentsPage" class="tab-content">
            <div class="batch-add-section">
                <h3>–î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ –≥—Ä—É–ø–ø–∞–º–∏</h3>
                <div class="batch-controls">
                    <div class="filter-group">
                        <label>–ü—Ä–æ—Ñ–µ—Å—Å–∏—è:</label>
                        <select class="filter-select" id="batchProfessionSelect" required>
                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ—Ñ–µ—Å—Å–∏—é</option>
                            <!-- –ü—Ä–æ—Ñ–µ—Å—Å–∏–∏ –±—É–¥—É—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω—ã —á–µ—Ä–µ–∑ JavaScript -->
                        </select>
                    </div>
                    <div>
                        <button class="btn btn-success" id="addMultipleStudentsBtn">+ –î–æ–±–∞–≤–∏—Ç—å —Å—Ç—É–¥–µ–Ω—Ç–æ–≤</button>
                    </div>
                </div>
            </div>

            <div class="filters">
                <div class="filter-group">
                    <h3>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ç—É–¥–µ–Ω—Ç–∞–º–∏</h3>
                </div>
                <div>
                    <button class="btn btn-success" id="addStudentBtn">+ –î–æ–±–∞–≤–∏—Ç—å —Å—Ç—É–¥–µ–Ω—Ç–∞</button>
                </div>
            </div>

            <div class="students-container">
                <div class="students-grid-cards" id="studentsTableBody">
                    <!-- –¢–∞–±–ª–∏—Ü–∞ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ –±—É–¥–µ—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω–∞ —á–µ—Ä–µ–∑ JavaScript -->
                </div>
            </div>
        </div>
    </div>

    <div id="notification" class="notification"></div>
    
    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Å—Ç—É–¥–µ–Ω—Ç–∞ -->
    <div id="addStudentModal" class="modal-overlay">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤–æ–≥–æ —Å—Ç—É–¥–µ–Ω—Ç–∞</h3>
                <button class="modal-close" onclick="hideAddStudentModal()">√ó</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="studentName">–§–ò–û —Å—Ç—É–¥–µ–Ω—Ç–∞:</label>
                    <input type="text" id="studentName" class="form-control" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–æ–ª–Ω–æ–µ –∏–º—è">
                </div>
                <div class="form-group">
                    <label for="studentProfession">–ü—Ä–æ—Ñ–µ—Å—Å–∏—è:</label>
                    <select id="studentProfession" class="form-control" required>
                        <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ—Ñ–µ—Å—Å–∏—é</option>
                        <!-- –ü—Ä–æ—Ñ–µ—Å—Å–∏–∏ –±—É–¥—É—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω—ã —á–µ—Ä–µ–∑ JavaScript -->
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn" onclick="hideAddStudentModal()">–û—Ç–º–µ–Ω–∞</button>
                <button class="btn btn-success" onclick="addNewStudent()">–î–æ–±–∞–≤–∏—Ç—å —Å—Ç—É–¥–µ–Ω—Ç–∞</button>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ -->
    <div id="addMultipleStudentsModal" class="modal-overlay">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">–î–æ–±–∞–≤–∏—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤</h3>
                <button class="modal-close" onclick="hideAddMultipleStudentsModal()">√ó</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="multipleStudentsNames">–°–ø–∏—Å–æ–∫ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ (–ø–æ –æ–¥–Ω–æ–º—É –Ω–∞ —Å—Ç—Ä–æ–∫—É, –º–∞–∫—Å–∏–º—É–º 33):</label>
                    <textarea id="multipleStudentsNames" class="form-control" placeholder="–í–≤–µ–¥–∏—Ç–µ –§–ò–û —Å—Ç—É–¥–µ–Ω—Ç–æ–≤, –∫–∞–∂–¥–æ–µ —Å –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏"></textarea>
                </div>
                <div class="form-group">
                    <label>–ü—Ä–æ—Ñ–µ—Å—Å–∏—è: <span id="selectedProfessionName"></span></label>
                    <input type="hidden" id="multipleStudentsProfession">
                </div>
                <div class="students-preview" id="multipleStudentsPreview">
                    <!-- –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ –±—É–¥–µ—Ç –∑–¥–µ—Å—å -->
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn" onclick="hideAddMultipleStudentsModal()">–û—Ç–º–µ–Ω–∞</button>
                <button class="btn btn-success" onclick="addMultipleStudents()">–î–æ–±–∞–≤–∏—Ç—å –≤—Å–µ—Ö —Å—Ç—É–¥–µ–Ω—Ç–æ–≤</button>
            </div>
        </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
<script>
    // ===== –ì–õ–û–ë–ê–õ–¨–ù–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï –ò –ö–û–ù–°–¢–ê–ù–¢–´ =====
    let currentUser = null;
    let students = [];
    let attendance = {};
    let hourlyAttendance = {}; // –î–æ–±–∞–≤–ª—è–µ–º –¥–ª—è –ø–æ—á–∞—Å–æ–≤–æ–≥–æ —É—á–µ—Ç–∞
    let currentDate = new Date();
    let selectedDate = new Date();
    let currentWeekStart = new Date();
    const DAYS_IN_WEEK = 6;
    const HOURS_PER_DAY = 6; // 6 —É—á–µ–±–Ω—ã—Ö —á–∞—Å–æ–≤ –≤ –¥–µ–Ω—å
    const API_BASE = '/api';
    let editMode = false;
    let isReadOnlyMode = false;
    let dataRefreshInterval = null;
    let savedProfessions = JSON.parse(localStorage.getItem('savedProfessions') || '{}');
    
    // –°–ø–∏—Å–æ–∫ –ø—Ä–æ—Ñ–µ—Å—Å–∏–π —Å –∫—É—Ä—Å–∞–º–∏
    const professions = [
        { id: '1-260101-00-a', name: '1-260101-00 ‚Äì –ò–¥–æ—Ä–∞–∏ –¥–∞–≤–ª–∞—Ç”£ (–∞)', course: 1 },
        { id: '1-250107', name: '1-250107 ‚Äì –ò“õ—Ç–∏—Å–æ–¥–∏—ë—Ç –≤–∞ –∏–¥–æ—Ä–∞ –¥–∞—Ä –∫–æ—Ä—Ö–æ–Ω–∞', course: 1 },
        { id: '1-270101-10', name: '1-270101-10 –ò“õ—Ç–∏—Å–æ–¥–∏—ë—Ç –≤–∞ —Ç–∞—à–∫–∏–ª–∏ –∏—Å—Ç–µ“≥—Å–æ–ª–æ—Ç', course: 1 },
        { id: '1-260101-00-b', name: '1-260101-00 ‚Äì –ò–¥–æ—Ä–∞ –¥–∞–≤–ª–∞—Ç”£ (–±)', course: 1 },
        { id: '1-400103', name: '1-400103 ‚Äì –ó–µ“≥–Ω–∏ —Å—É–Ω—ä”£', course: 1 },
        { id: '1-08010107', name: '1-08010107 ‚Äì –¢–∞—ä–ª–∏–º–∏ –∫–∞—Å–±”£ (–∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–∫–∞)', course: 1 },
        { id: '1-40010202', name: '1-40010202 ‚Äì –¢–µ—Ö–Ω–∞–ª–æ–≥–∏—è –≤–∞ –Ω–∏–∑–æ–º–∏ –∏—Ç—Ç–∏–ª–æ–æ—Ç–∏ –¥–∞—Ä –∏“õ—Ç–∏—Å–æ–¥–∏—ë—Ç', course: 1 },
        { id: '2-260101-00', name: '2-260101-00 ‚Äì –ò–¥–æ—Ä–∞–∏ –¥–∞–≤–ª–∞—Ç”£', course: 2 },
        { id: '2-260202', name: '2-260202 ‚Äì –ú–µ–Ω–µ“∑–º–µ–Ω—Ç', course: 2 },
        { id: '2-270101-10', name: '2-270101-10 ‚Äì –ò“õ—Ç–∏—Å–æ–¥–∏—ë—Ç –≤–∞ —Ç–∞—à–∫–∏–ª–∏ –∏—Å—Ç–µ“≥—Å–æ–ª–æ—Ç (–¥–∞—Ä —Å–æ“≥–∞–∏ —ç–Ω–µ—Ä–≥–µ—Ç–∏–∫–∞)', course: 2 },
        { id: '2-31030103', name: '2-31030103 ‚Äì –ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞ (—Ñ–∞—ä–æ–ª–∏—è—Ç–∏ –∏“õ—Ç–∏—Å–æ–¥”£)', course: 2 },
        { id: '2-40010202', name: '2-40010202 ‚Äì –¢–µ—Ö–Ω–∞–ª–æ–≥–∏—è –≤–∞ –Ω–∏–∑–æ–º–∏ –∏—Ç—Ç–∏–ª–æ–æ—Ç –¥–∞—Ä –∏“õ—Ç–∏—Å–æ–¥–∏—ë—Ç', course: 2 },
        { id: '2-400103', name: '2-400103 ‚Äì –ó–µ“≥–Ω–∏ —Å—É–Ω—ä”£', course: 2 },
        { id: '3-260101-00', name: '3-260101-00 ‚Äì –ò–¥–æ—Ä–∞–∏ –¥–∞–≤–ª–∞—Ç”£', course: 3 },
        { id: '3-40010202', name: '3-40010202 ‚Äì –¢–µ—Ö–Ω–∞–ª–æ–≥–∏—è –≤–∞ –Ω–∏–∑–æ–º–∏ –∏—Ç—Ç–∏–ª–æ–æ—Ç–∏ –¥–∞—Ä –∏“õ—Ç–∏—Å–æ–¥–∏—ë—Ç', course: 3 },
        { id: '3-400103', name: '3-400103 ‚Äì –ó–µ“≥–Ω–∏ —Å—É–Ω—ä”£', course: 3 }
    ];

    // WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ
    const socket = io();

    // ===== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –ü–†–ò–õ–û–ñ–ï–ù–ò–Ø =====
    document.addEventListener('DOMContentLoaded', function() {
        console.log('Initializing application...');
        loadUserData();
        setupEventListeners();
        setupSocketListeners();
        initializeApp();
        startDataRefresh();
    });

    // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    function loadUserData() {
        const userData = localStorage.getItem('currentUser');
        if (userData) {
            currentUser = JSON.parse(userData);
            console.log('User loaded:', currentUser);
            updateUIForUserRole();
        } else {
            console.log('No user data, redirecting to login...');
            window.location.href = 'index.html';
        }
    }

    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ä–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    function updateUIForUserRole() {
        document.getElementById('userName').textContent = currentUser.name;
        document.getElementById('userRole').textContent = getRoleDisplayName(currentUser.role);
        
        setupAccessRights();
    }

    function getRoleDisplayName(role) {
        const roles = {
            'admin': '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä',
            'dekan': '–î–µ–∫–∞–Ω', 
            'dezhur': '–î–µ–∂—É—Ä–Ω—ã–π',
            'teacher': '–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å'
        };
        return roles[role] || '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å';
    }

    function setupAccessRights() {
        if (currentUser.role === 'admin' || currentUser.role === 'dekan') {
            document.getElementById('addStudentBtn').style.display = 'block';
            document.getElementById('addMultipleStudentsBtn').style.display = 'block';
        } else {
            document.getElementById('addStudentBtn').style.display = 'none';
            document.getElementById('addMultipleStudentsBtn').style.display = 'none';
        }
        
        if (currentUser.role === 'dezhur') {
            document.getElementById('saveSection').style.display = 'block';
            document.getElementById('editModeContainer').style.display = 'none';
        } else {
            document.getElementById('editModeContainer').style.display = 'block';
            document.getElementById('saveSection').style.display = 'none';
        }
        
        if (currentUser.role === 'dezhur') {
            checkSavedProfessions();
        }
    }

    function checkSavedProfessions() {
        const today = formatDate(new Date());
        const professionSelect = document.getElementById('professionSelect');
        
        Array.from(professionSelect.options).forEach(option => {
            if (option.value && savedProfessions[option.value] === today) {
                option.disabled = true;
            }
        });
        
        if (professionSelect.value && savedProfessions[professionSelect.value] === today) {
            professionSelect.value = '';
            applyFilters();
        }
    }

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
    function initializeApp() {
        console.log('Initializing app data...');
        populateProfessionSelects();
        calculateCurrentWeek();
        generateCalendar();
        updateDateDisplay();
        updateWeekDisplay();
        loadStudents();
        loadAttendance();
    }

    // –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Å–µ–ª–µ–∫—Ç–æ—Ä–æ–≤ –ø—Ä–æ—Ñ–µ—Å—Å–∏–π
    function populateProfessionSelects() {
        const selects = [
            'professionSelect',
            'weeklyProfessionSelect', 
            'batchProfessionSelect',
            'studentProfession'
        ];
        
        selects.forEach(selectId => {
            const select = document.getElementById(selectId);
            select.innerHTML = '<option value="">–í—Å–µ –ø—Ä–æ—Ñ–µ—Å—Å–∏–∏</option>';
            
            professions.forEach(prof => {
                const option = document.createElement('option');
                option.value = prof.id;
                option.textContent = prof.name;
                select.appendChild(option);
            });
        });
    }

    // –†–∞—Å—á–µ—Ç —Ç–µ–∫—É—â–µ–π –Ω–µ–¥–µ–ª–∏
    function calculateCurrentWeek() {
        const today = new Date();
        const dayOfWeek = today.getDay();
        const diff = today.getDate() - dayOfWeek + (dayOfWeek === 0 ? -6 : 1);
        currentWeekStart = new Date(today.setDate(diff));
    }

    // ===== –†–ê–ë–û–¢–ê –° API =====
    // –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ —Å —Å–µ—Ä–≤–µ—Ä–∞
    async function loadStudents() {
        try {
            console.log('Loading students from server...');
            showNotification('–ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤...', 'info');
            
            const response = await fetch(`${API_BASE}/students`);
            if (response.ok) {
                students = await response.json();
                console.log('Students loaded:', students.length);
                renderStudentsGrid();
                renderWeeklyTable();
                renderStudentsTable();
                updateStats();
                showNotification('–°—Ç—É–¥–µ–Ω—Ç—ã –∑–∞–≥—Ä—É–∂–µ–Ω—ã', 'success');
            } else {
                console.error('Failed to load students:', response.status);
                showNotification('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤', 'error');
                loadDemoStudents();
            }
        } catch (error) {
            console.error('Error loading students:', error);
            showNotification('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º', 'error');
            loadDemoStudents();
        }
    }

    // –î–µ–º–æ-–¥–∞–Ω–Ω—ã–µ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
    function loadDemoStudents() {
        console.log('Loading demo students data...');
        students = [
            { id: 1, name: '–ê–ª–∏—à–µ—Ä –£—Å–º–∞–Ω–æ–≤', group: '1-260101-00-a', course: 1 },
            { id: 2, name: '–§–∞—Ä—Ö–æ–¥ –†–∞—Ö–∏–º–æ–≤', group: '1-260101-00-a', course: 1 },
            { id: 3, name: '–®–∞—Ö–∑–æ–¥ –£—Å—É–ø–æ–≤', group: '1-260101-00-a', course: 1 },
            { id: 4, name: '–ì–∞–ª–∏–Ω–∞ –¢–æ–ª–æ—á–∫–æ', group: '1-250107', course: 1 },
            { id: 5, name: '–ú–∏—Ä–æ—Å–ª–∞–≤ –£–ª—å—è–Ω–µ–Ω–∫–æ', group: '1-250107', course: 1 }
        ];
        renderStudentsGrid();
        renderWeeklyTable();
        renderStudentsTable();
        updateStats();
    }

    // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –æ –ø–æ—Å–µ—â–∞–µ–º–æ—Å—Ç–∏ (–æ–±–Ω–æ–≤–ª—è–µ–º –¥–ª—è –ø–æ—á–∞—Å–æ–≤–æ–≥–æ —É—á–µ—Ç–∞)
    async function loadAttendance() {
        try {
            console.log('Loading attendance data...');
            const response = await fetch(`${API_BASE}/attendance`);
            if (response.ok) {
                const data = await response.json();
                attendance = data.daily || {};
                hourlyAttendance = data.hourly || {};
                console.log('Attendance data loaded');
                renderStudentsGrid();
                renderWeeklyTable();
                updateStats();
            } else {
                console.log('No attendance data, using empty objects');
                attendance = {};
                hourlyAttendance = {};
            }
        } catch (error) {
            console.error('Error loading attendance:', error);
            attendance = {};
            hourlyAttendance = {};
        }
    }

    // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å—Ç—É–¥–µ–Ω—Ç–∞
    async function addStudent(studentData) {
        try {
            console.log('Adding student:', studentData);
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —É–∂–µ —Å—Ç—É–¥–µ–Ω—Ç —Å —Ç–∞–∫–∏–º –∏–º–µ–Ω–µ–º
            const existingStudent = students.find(s => 
                s.name.toLowerCase() === studentData.name.toLowerCase() && 
                s.group === studentData.group
            );
            
            if (existingStudent) {
                showNotification('–°—Ç—É–¥–µ–Ω—Ç —Å —Ç–∞–∫–∏–º –∏–º–µ–Ω–µ–º —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ —ç—Ç–æ–π –≥—Ä—É–ø–ø–µ', 'error');
                return false;
            }

            const response = await fetch(`${API_BASE}/students`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(studentData)
            });

            if (response.ok) {
                const newStudent = await response.json();
                console.log('Student added successfully:', newStudent);
                
                students.push(newStudent);
                renderStudentsGrid();
                renderWeeklyTable();
                renderStudentsTable();
                updateStats();
                
                socket.emit('student_added', newStudent);
                
                showNotification('–°—Ç—É–¥–µ–Ω—Ç —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω', 'success');
                return true;
            } else {
                const errorText = await response.text();
                console.error('Server error:', errorText);
                showNotification('–û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Å—Ç—É–¥–µ–Ω—Ç–∞: ' + errorText, 'error');
                return false;
            }
        } catch (error) {
            console.error('Error adding student:', error);
            showNotification('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º', 'error');
            return false;
        }
    }

    // –ú–∞—Å—Å–æ–≤–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤
    async function addMultipleStudents(studentsList) {
        try {
            console.log('Adding multiple students:', studentsList.length);
            
            const response = await fetch(`${API_BASE}/students/batch`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ students: studentsList })
            });

            if (response.ok) {
                const result = await response.json();
                console.log('Batch add result:', result);
                
                // –ó–∞–≥—Ä—É–∂–∞–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤
                await loadStudents();
                
                showNotification(`–£—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ ${result.added} –∏–∑ ${studentsList.length} —Å—Ç—É–¥–µ–Ω—Ç–æ–≤`, 'success');
                return result.added === studentsList.length;
            } else {
                const errorText = await response.text();
                console.error('Server error:', errorText);
                showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤: ' + errorText, 'error');
                return false;
            }
        } catch (error) {
            console.error('Error adding multiple students:', error);
            
            // Fallback: –¥–æ–±–∞–≤–ª—è–µ–º –ø–æ –æ–¥–Ω–æ–º—É –µ—Å–ª–∏ batch endpoint –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
            console.log('Using fallback: adding students one by one');
            let successCount = 0;
            for (const studentData of studentsList) {
                const result = await addStudent(studentData);
                if (result) successCount++;
            }
            
            showNotification(`–£—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ ${successCount} –∏–∑ ${studentsList.length} —Å—Ç—É–¥–µ–Ω—Ç–æ–≤`, 'success');
            return successCount === studentsList.length;
        }
    }

    // –£–¥–∞–ª–µ–Ω–∏–µ —Å—Ç—É–¥–µ–Ω—Ç–∞
    async function deleteStudent(studentId) {
        if (!confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ–≥–æ —Å—Ç—É–¥–µ–Ω—Ç–∞?')) {
            return false;
        }

        try {
            console.log('Deleting student:', studentId);
            
            const response = await fetch(`${API_BASE}/students/${studentId}`, {
                method: 'DELETE'
            });

            if (response.ok) {
                console.log('Student deleted successfully');
                
                students = students.filter(s => s.id !== studentId);
                renderStudentsGrid();
                renderWeeklyTable();
                renderStudentsTable();
                updateStats();
                
                socket.emit('student_deleted', studentId);
                
                showNotification('–°—Ç—É–¥–µ–Ω—Ç —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω', 'success');
                return true;
            } else {
                const errorText = await response.text();
                console.error('Server error:', errorText);
                showNotification('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è —Å—Ç—É–¥–µ–Ω—Ç–∞: ' + errorText, 'error');
                return false;
            }
        } catch (error) {
            console.error('Error deleting student:', error);
            showNotification('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º', 'error');
            return false;
        }
    }

    // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –æ –ø–æ—Å–µ—â–∞–µ–º–æ—Å—Ç–∏ (–æ–±–Ω–æ–≤–ª—è–µ–º –¥–ª—è –ø–æ—á–∞—Å–æ–≤–æ–≥–æ —É—á–µ—Ç–∞)
    async function saveAttendance(studentId, date, status, hour = null) {
        try {
            console.log(`Saving attendance: ${studentId}, ${date}, ${status}, hour: ${hour}`);
            
            const attendanceData = {
                studentId: studentId,
                date: date,
                status: status,
                hour: hour
            };

            const response = await fetch(`${API_BASE}/attendance`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(attendanceData)
            });

            if (response.ok) {
                console.log('Attendance saved successfully');
                
                if (hour !== null) {
                    // –ü–æ—á–∞—Å–æ–≤–æ–π —É—á–µ—Ç
                    if (!hourlyAttendance[date]) {
                        hourlyAttendance[date] = {};
                    }
                    if (!hourlyAttendance[date][studentId]) {
                        hourlyAttendance[date][studentId] = {};
                    }
                    hourlyAttendance[date][studentId][hour] = status;
                } else {
                    // –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π —É—á–µ—Ç (–¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏)
                    if (!attendance[date]) {
                        attendance[date] = {};
                    }
                    attendance[date][studentId] = status;
                }
                
                renderStudentsGrid();
                renderWeeklyTable();
                updateStats();
                
                socket.emit('attendance_updated', attendanceData);
                
                return true;
            } else {
                const errorText = await response.text();
                console.error('Server error:', errorText);
                showNotification('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–æ—Å–µ—â–∞–µ–º–æ—Å—Ç–∏', 'error');
                return false;
            }
        } catch (error) {
            console.error('Error saving attendance:', error);
            showNotification('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º', 'error');
            return false;
        }
    }

    // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤—Å–µ—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π –ø–æ—Å–µ—â–∞–µ–º–æ—Å—Ç–∏ –¥–ª—è –¥–µ–∂—É—Ä–Ω–æ–≥–æ
    async function saveAllAttendance() {
        const professionSelect = document.getElementById('professionSelect');
        const selectedProfession = professionSelect.value;
        const today = formatDate(new Date());
        
        if (!selectedProfession) {
            showNotification('–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ—Ñ–µ—Å—Å–∏—é –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è', 'error');
            return;
        }
        
        try {
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–π –ø—Ä–æ—Ñ–µ—Å—Å–∏–∏
            const dateStr = formatDate(selectedDate);
            const dailyAttendance = attendance[dateStr] || {};
            const hourlyData = hourlyAttendance[dateStr] || {};
            
            let saveCount = 0;
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –µ–∂–µ–¥–Ω–µ–≤–Ω—É—é –ø–æ—Å–µ—â–∞–µ–º–æ—Å—Ç—å
            for (const [studentId, status] of Object.entries(dailyAttendance)) {
                const student = students.find(s => s.id === parseInt(studentId));
                if (student && student.group === selectedProfession) {
                    await saveAttendance(parseInt(studentId), dateStr, status);
                    saveCount++;
                }
            }
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø–æ—á–∞—Å–æ–≤—É—é –ø–æ—Å–µ—â–∞–µ–º–æ—Å—Ç—å
            for (const [studentId, hoursData] of Object.entries(hourlyData)) {
                const student = students.find(s => s.id === parseInt(studentId));
                if (student && student.group === selectedProfession) {
                    for (const [hour, status] of Object.entries(hoursData)) {
                        await saveAttendance(parseInt(studentId), dateStr, status, parseInt(hour));
                    }
                }
            }
            
            // –ü–æ–º–µ—á–∞–µ–º –ø—Ä–æ—Ñ–µ—Å—Å–∏—é –∫–∞–∫ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—É—é
            savedProfessions[selectedProfession] = today;
            localStorage.setItem('savedProfessions', JSON.stringify(savedProfessions));
            
            checkSavedProfessions();
            
            showNotification(`–ü–æ—Å–µ—â–∞–µ–º–æ—Å—Ç—å –¥–ª—è ${saveCount} —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞`, 'success');
        } catch (error) {
            console.error('Error saving all attendance:', error);
            showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –ø–æ—Å–µ—â–∞–µ–º–æ—Å—Ç–∏', 'error');
        }
    }

    // ===== –†–ï–ù–î–ï–†–ò–ù–ì –ò–ù–¢–ï–†–§–ï–ô–°–ê =====
    // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–∞–ª–µ–Ω–¥–∞—Ä—è
    function generateCalendar() {
        const calendarGrid = document.getElementById('calendarGrid');
        calendarGrid.innerHTML = '';
        
        const dayNames = ['–ü–Ω', '–í—Ç', '–°—Ä', '–ß—Ç', '–ü—Ç', '–°–±', '–í—Å'];
        dayNames.forEach(day => {
            const dayHeader = document.createElement('div');
            dayHeader.className = 'calendar-day-header';
            dayHeader.textContent = day;
            calendarGrid.appendChild(dayHeader);
        });
        
        const firstDay = new Date(currentDate.getFullYear(), currentDate.getMonth(), 1);
        const lastDay = new Date(currentDate.getFullYear(), currentDate.getMonth() + 1, 0);
        
        let firstDayOfWeek = firstDay.getDay();
        if (firstDayOfWeek === 0) firstDayOfWeek = 7;
        
        for (let i = 1; i < firstDayOfWeek; i++) {
            const emptyDay = document.createElement('div');
            emptyDay.className = 'calendar-day readonly';
            calendarGrid.appendChild(emptyDay);
        }
        
        for (let day = 1; day <= lastDay.getDate(); day++) {
            const dayElement = document.createElement('button');
            dayElement.className = 'calendar-day';
            
            const dayNumber = document.createElement('div');
            dayNumber.className = 'day-number';
            dayNumber.textContent = day;
            dayElement.appendChild(dayNumber);
            
            const dayOfWeek = new Date(currentDate.getFullYear(), currentDate.getMonth(), day).getDay();
            if (dayOfWeek === 0 || dayOfWeek === 6) {
                dayElement.classList.add('weekend');
            }
            
            const today = new Date();
            if (day === today.getDate() && 
                currentDate.getMonth() === today.getMonth() && 
                currentDate.getFullYear() === today.getFullYear()) {
                dayElement.classList.add('today');
            }
            
            if (day === selectedDate.getDate() && 
                currentDate.getMonth() === selectedDate.getMonth() && 
                currentDate.getFullYear() === selectedDate.getFullYear()) {
                dayElement.classList.add('selected');
            }
            
            const dateStr = formatDate(new Date(currentDate.getFullYear(), currentDate.getMonth(), day));
            if (attendance[dateStr]) {
                const presentCount = Object.values(attendance[dateStr]).filter(status => status === 'present').length;
                const absentCount = Object.values(attendance[dateStr]).filter(status => status === 'absent').length;
                
                if (presentCount > 0 || absentCount > 0) {
                    const stats = document.createElement('div');
                    stats.className = 'day-stats';
                    stats.textContent = `${presentCount}‚úì ${absentCount}‚úó`;
                    dayElement.appendChild(stats);
                    
                    if (absentCount > 0) {
                        dayElement.classList.add('absent-data');
                    } else {
                        dayElement.classList.add('has-data');
                    }
                }
            }
            
            dayElement.addEventListener('click', () => {
                selectDate(new Date(currentDate.getFullYear(), currentDate.getMonth(), day));
            });
            
            calendarGrid.appendChild(dayElement);
        }
        
        updateDateDisplay();
    }

    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–∞—Ç—ã
    function updateDateDisplay() {
        const options = { year: 'numeric', month: 'long', day: 'numeric' };
        document.getElementById('currentDate').textContent = currentDate.toLocaleDateString('ru-RU', { year: 'numeric', month: 'long' });
        document.getElementById('selectedDateDisplay').textContent = selectedDate.toLocaleDateString('ru-RU', options);
    }

    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–µ–¥–µ–ª–∏
    function updateWeekDisplay() {
        const weekEnd = new Date(currentWeekStart);
        weekEnd.setDate(currentWeekStart.getDate() + 5);
        
        const options = { day: 'numeric', month: 'long' };
        const startStr = currentWeekStart.toLocaleDateString('ru-RU', options);
        const endStr = weekEnd.toLocaleDateString('ru-RU', options);
        
        document.getElementById('currentWeekRange').textContent = `${startStr} - ${endStr}`;
    }

    // –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ —Å–ø–∏—Å–∫–∞ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ –¥–ª—è –µ–∂–µ–¥–Ω–µ–≤–Ω–æ–≥–æ —É—á–µ—Ç–∞ (–æ–±–Ω–æ–≤–ª—è–µ–º –¥–ª—è –ø–æ—á–∞—Å–æ–≤–æ–≥–æ —É—á–µ—Ç–∞)
    function renderStudentsGrid() {
        const studentsGrid = document.getElementById('studentsGrid');
        studentsGrid.innerHTML = '';
        
        if (students.length === 0) {
            studentsGrid.innerHTML = '<div class="student-card"><div class="student-name">–ù–µ—Ç —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è</div></div>';
            return;
        }
        
        const dateStr = formatDate(selectedDate);
        const todayStr = formatDate(new Date());
        const isToday = dateStr === todayStr;
        
        const professionFilter = document.getElementById('professionSelect').value;
        
        const filteredStudents = students.filter(student => {
            if (professionFilter && student.group !== professionFilter) return false;
            return true;
        });
        
        if (filteredStudents.length === 0) {
            studentsGrid.innerHTML = '<div class="student-card"><div class="student-name">–ù–µ—Ç —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ –ø–æ –≤—ã–±—Ä–∞–Ω–Ω—ã–º –∫—Ä–∏—Ç–µ—Ä–∏—è–º</div></div>';
            return;
        }
        
        const isProfessionSaved = currentUser.role === 'dezhur' && professionFilter && savedProfessions[professionFilter] === todayStr;
        
        filteredStudents.forEach(student => {
            const studentCard = document.createElement('div');
            studentCard.className = 'student-card';
            
            // –ü–æ–ª—É—á–∞–µ–º –ø–æ—á–∞—Å–æ–≤—É—é –ø–æ—Å–µ—â–∞–µ–º–æ—Å—Ç—å
            const hourlyData = hourlyAttendance[dateStr] && hourlyAttendance[dateStr][student.id] ? 
                hourlyAttendance[dateStr][student.id] : {};
            
            // –°—á–∏—Ç–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ —á–∞—Å–∞–º
            let presentHours = 0;
            let absentHours = 0;
            
            for (let hour = 1; hour <= HOURS_PER_DAY; hour++) {
                if (hourlyData[hour] === 'present') {
                    presentHours++;
                } else if (hourlyData[hour] === 'absent') {
                    absentHours++;
                }
            }
            
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –æ–±—â–∏–π —Å—Ç–∞—Ç—É—Å –Ω–∞ –¥–µ–Ω—å
            let overallStatus = 'unknown';
            if (presentHours > 0 && absentHours === 0) {
                overallStatus = 'present';
            } else if (absentHours > 0) {
                overallStatus = 'absent';
            }
            
            const statusText = {
                'present': '–ü—Ä–∏—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª',
                'absent': '–û—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª', 
                'unknown': '–ù–µ –æ—Ç–º–µ—á–µ–Ω'
            };
            
            const statusClass = {
                'present': 'status-present',
                'absent': 'status-absent',
                'unknown': 'status-unknown'
            };
            
            const professionName = professions.find(p => p.id === student.group)?.name || student.group;
            
            const canEdit = (editMode || currentUser.role === 'dezhur') && 
                           (isToday || currentUser.role !== 'dezhur') && 
                           !isProfessionSaved;
            
            studentCard.innerHTML = `
                <div class="student-header">
                    <div>
                        <div class="student-name">${student.name}</div>
                        <div class="student-details">${professionName}</div>
                    </div>
                    <div class="attendance-status ${statusClass[overallStatus]}">
                        ${statusText[overallStatus]}
                    </div>
                </div>
                <div class="hourly-controls">
                    ${generateHourlyControls(student.id, hourlyData, canEdit)}
                </div>
                <div class="hour-summary">
                    <div class="hourly-stats">
                        <span class="hours-present">‚úì ${presentHours}—á</span>
                        <span class="hours-absent">‚úó ${absentHours}—á</span>
                    </div>
                </div>
            `;
            
            studentsGrid.appendChild(studentCard);
        });
        
        // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π –¥–ª—è –∫–Ω–æ–ø–æ–∫ —á–∞—Å–æ–≤
        document.querySelectorAll('.hour-btn').forEach(button => {
            button.addEventListener('click', function() {
                if (this.disabled) return;
                
                const studentId = parseInt(this.getAttribute('data-student'));
                const hour = parseInt(this.getAttribute('data-hour'));
                const currentStatus = this.getAttribute('data-status');
                
                // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º —Å—Ç–∞—Ç—É—Å: present -> absent -> present
                let newStatus = 'present';
                if (currentStatus === 'present') {
                    newStatus = 'absent';
                } else if (currentStatus === 'absent') {
                    newStatus = 'present';
                }
                
                markHourlyAttendance(studentId, hour, newStatus);
            });
        });
        
        updateDailyStats();
    }

    // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–æ–Ω—Ç—Ä–æ–ª–æ–≤ –¥–ª—è –ø–æ—á–∞—Å–æ–≤–æ–≥–æ —É—á–µ—Ç–∞
    function generateHourlyControls(studentId, hourlyData, canEdit) {
        let controlsHTML = '';
        
        for (let hour = 1; hour <= HOURS_PER_DAY; hour++) {
            const currentStatus = hourlyData[hour] || 'unknown';
            let buttonClass = 'hour-btn';
            let buttonText = hour;
            
            if (currentStatus === 'present') {
                buttonClass += ' present';
                buttonText = '‚úì';
            } else if (currentStatus === 'absent') {
                buttonClass += ' absent';
                buttonText = '‚úó';
            }
            
            controlsHTML += `
                <div>
                    <div class="hour-label">${hour}—á</div>
                    <button class="${buttonClass}" 
                            data-student="${studentId}" 
                            data-hour="${hour}"
                            data-status="${currentStatus}"
                            ${!canEdit ? 'disabled' : ''}>
                        ${buttonText}
                    </button>
                </div>
            `;
        }
        
        return controlsHTML;
    }

    // –û—Ç–º–µ—Ç–∫–∞ –ø–æ—á–∞—Å–æ–≤–æ–π –ø–æ—Å–µ—â–∞–µ–º–æ—Å—Ç–∏
    function markHourlyAttendance(studentId, hour, status) {
        const dateStr = formatDate(selectedDate);
        saveAttendance(studentId, dateStr, status, hour);
    }

    // –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ –Ω–µ–¥–µ–ª—å–Ω–æ–≥–æ –æ—Ç—á–µ—Ç–∞
    function renderWeeklyTable() {
        const weeklyTableBody = document.getElementById('weeklyTableBody');
        weeklyTableBody.innerHTML = '';
        
        if (students.length === 0) {
            weeklyTableBody.innerHTML = '<tr><td colspan="10">–ù–µ—Ç —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è</td></tr>';
            return;
        }
        
        const professionFilter = document.getElementById('weeklyProfessionSelect').value;
        
        const filteredStudents = students.filter(student => {
            if (professionFilter && student.group !== professionFilter) return false;
            return true;
        });
        
        if (filteredStudents.length === 0) {
            weeklyTableBody.innerHTML = '<tr><td colspan="10">–ù–µ—Ç —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ –ø–æ –≤—ã–±—Ä–∞–Ω–Ω—ã–º –∫—Ä–∏—Ç–µ—Ä–∏—è–º</td></tr>';
            return;
        }
        
        const weekDates = [];
        for (let i = 0; i < DAYS_IN_WEEK; i++) {
            const date = new Date(currentWeekStart);
            date.setDate(currentWeekStart.getDate() + i);
            weekDates.push(date);
        }
        
        filteredStudents.forEach(student => {
            const row = document.createElement('tr');
            
            const nameCell = document.createElement('td');
            nameCell.className = 'student-name';
            nameCell.textContent = student.name;
            row.appendChild(nameCell);
            
            let presentCount = 0;
            let absentCount = 0;
            
            weekDates.forEach(date => {
                const dateStr = formatDate(date);
                const cell = document.createElement('td');
                
                if (attendance[dateStr] && attendance[dateStr][student.id]) {
                    const status = attendance[dateStr][student.id];
                    if (status === 'present') {
                        cell.className = 'present-cell';
                        cell.textContent = '+';
                        presentCount++;
                    } else if (status === 'absent') {
                        cell.className = 'absent-cell';
                        cell.textContent = '-';
                        absentCount++;
                    }
                } else {
                    cell.textContent = '';
                }
                
                row.appendChild(cell);
            });
            
            const totalCell = document.createElement('td');
            totalCell.className = 'total-cell';
            totalCell.textContent = DAYS_IN_WEEK;
            row.appendChild(totalCell);
            
            const presentCell = document.createElement('td');
            presentCell.textContent = presentCount;
            row.appendChild(presentCell);
            
            const absentCell = document.createElement('td');
            absentCell.textContent = absentCount;
            row.appendChild(absentCell);
            
            weeklyTableBody.appendChild(row);
        });
        
        updateWeeklyStats();
    }

    // –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ —Ç–∞–±–ª–∏—Ü—ã —Å—Ç—É–¥–µ–Ω—Ç–æ–≤
    function renderStudentsTable() {
        const studentsTableBody = document.getElementById('studentsTableBody');
        studentsTableBody.innerHTML = '';
        
        if (students.length === 0) {
            studentsTableBody.innerHTML = '<div class="student-card"><div class="student-name">–ù–µ—Ç —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è</div></div>';
            return;
        }
        
        students.forEach(student => {
            const studentCard = document.createElement('div');
            studentCard.className = 'student-card';
            
            const professionName = professions.find(p => p.id === student.group)?.name || student.group;
            
            studentCard.innerHTML = `
                <div class="student-header">
                    <div>
                        <div class="student-name">${student.name}</div>
                        <div class="student-details">${professionName}</div>
                    </div>
                </div>
                <div class="card-attendance-controls">
                    ${currentUser.role === 'admin' || currentUser.role === 'dekan' ? 
                        `<button class="btn btn-danger" onclick="deleteStudent(${student.id})">–£–¥–∞–ª–∏—Ç—å</button>` : 
                        `<button class="btn" disabled>–£–¥–∞–ª–∏—Ç—å</button>`
                    }
                </div>
            `;
            
            studentsTableBody.appendChild(studentCard);
        });
    }

    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
    function updateStats() {
        updateDailyStats();
        updateWeeklyStats();
    }

    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –µ–∂–µ–¥–Ω–µ–≤–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ (–æ–±–Ω–æ–≤–ª—è–µ–º –¥–ª—è –ø–æ—á–∞—Å–æ–≤–æ–≥–æ —É—á–µ—Ç–∞)
    function updateDailyStats() {
        const dateStr = formatDate(selectedDate);
        const dailyAttendance = attendance[dateStr] || {};
        const hourlyData = hourlyAttendance[dateStr] || {};
        
        const professionFilter = document.getElementById('professionSelect').value;
        
        const filteredStudents = students.filter(student => {
            if (professionFilter && student.group !== professionFilter) return false;
            return true;
        });
        
        let totalStudents = filteredStudents.length;
        let presentCount = 0;
        let absentCount = 0;
        let totalHoursPresent = 0;
        let totalHoursAbsent = 0;
        
        filteredStudents.forEach(student => {
            const studentHourlyData = hourlyData[student.id] || {};
            let studentPresentHours = 0;
            let studentAbsentHours = 0;
            
            for (let hour = 1; hour <= HOURS_PER_DAY; hour++) {
                if (studentHourlyData[hour] === 'present') {
                    studentPresentHours++;
                } else if (studentHourlyData[hour] === 'absent') {
                    studentAbsentHours++;
                }
            }
            
            totalHoursPresent += studentPresentHours;
            totalHoursAbsent += studentAbsentHours;
            
            // –°—á–∏—Ç–∞–µ–º —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ –∫–∞–∫ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—â–∏—Ö –µ—Å–ª–∏ –æ–Ω–∏ –±—ã–ª–∏ –Ω–∞ —Ö–æ—Ç—è –±—ã –æ–¥–Ω–æ–º –∑–∞–Ω—è—Ç–∏–∏
            if (studentPresentHours > 0) {
                presentCount++;
            }
            
            // –°—á–∏—Ç–∞–µ–º —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ –∫–∞–∫ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏—Ö –µ—Å–ª–∏ –æ–Ω–∏ –ø—Ä–æ–ø—É—Å—Ç–∏–ª–∏ –≤—Å–µ –∑–∞–Ω—è—Ç–∏—è
            if (studentAbsentHours === HOURS_PER_DAY && studentPresentHours === 0) {
                absentCount++;
            }
        });
        
        const totalPossibleHours = totalStudents * HOURS_PER_DAY;
        const attendanceRate = totalPossibleHours > 0 ? 
            Math.round((totalHoursPresent / totalPossibleHours) * 100) : 0;
        
        document.getElementById('dailyTotalStudents').textContent = totalStudents;
        document.getElementById('dailyPresent').textContent = presentCount;
        document.getElementById('dailyAbsent').textContent = absentCount;
        document.getElementById('dailyAttendance').textContent = `${attendanceRate}%`;
    }

    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–µ–¥–µ–ª—å–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ (–æ–±–Ω–æ–≤–ª—è–µ–º –¥–ª—è –ø–æ—á–∞—Å–æ–≤–æ–≥–æ —É—á–µ—Ç–∞)
    function updateWeeklyStats() {
        const professionFilter = document.getElementById('weeklyProfessionSelect').value;
        
        const filteredStudents = students.filter(student => {
            if (professionFilter && student.group !== professionFilter) return false;
            return true;
        });
        
        const weekDates = [];
        for (let i = 0; i < DAYS_IN_WEEK; i++) {
            const date = new Date(currentWeekStart);
            date.setDate(currentWeekStart.getDate() + i);
            weekDates.push(date);
        }
        
        let totalPresentDays = 0;
        let totalAbsentDays = 0;
        let totalHoursPresent = 0;
        let totalHoursAbsent = 0;
        let totalPossibleHours = filteredStudents.length * DAYS_IN_WEEK * HOURS_PER_DAY;
        
        weekDates.forEach(date => {
            const dateStr = formatDate(date);
            const dailyHourlyData = hourlyAttendance[dateStr] || {};
            
            filteredStudents.forEach(student => {
                const studentHourlyData = dailyHourlyData[student.id] || {};
                let studentPresentHours = 0;
                let studentAbsentHours = 0;
                
                for (let hour = 1; hour <= HOURS_PER_DAY; hour++) {
                    if (studentHourlyData[hour] === 'present') {
                        studentPresentHours++;
                    } else if (studentHourlyData[hour] === 'absent') {
                        studentAbsentHours++;
                    }
                }
                
                totalHoursPresent += studentPresentHours;
                totalHoursAbsent += studentAbsentHours;
                
                // –°—á–∏—Ç–∞–µ–º –¥–Ω–∏ –ø–æ—Å–µ—â–µ–Ω–∏—è
                if (studentPresentHours > 0) {
                    totalPresentDays++;
                }
                
                // –°—á–∏—Ç–∞–µ–º –¥–Ω–∏ –ø–æ–ª–Ω–æ–≥–æ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è
                if (studentAbsentHours === HOURS_PER_DAY && studentPresentHours === 0) {
                    totalAbsentDays++;
                }
            });
        });
        
        const avgAttendance = totalPossibleHours > 0 ? 
            Math.round((totalHoursPresent / totalPossibleHours) * 100) : 0;
        
        document.getElementById('weeklyTotalStudents').textContent = filteredStudents.length;
        document.getElementById('weeklyAvgAttendance').textContent = `${avgAttendance}%`;
        document.getElementById('weeklyTotalPresent').textContent = totalPresentDays;
        document.getElementById('weeklyTotalAbsent').textContent = totalAbsentDays;
    }

    // ===== –û–ë–†–ê–ë–û–¢–ß–ò–ö–ò –°–û–ë–´–¢–ò–ô =====
    // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π
    function setupEventListeners() {
        // –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –º–µ—Å—è—Ü–∞–º
        document.getElementById('prevMonth').addEventListener('click', () => navigateMonths(-1));
        document.getElementById('nextMonth').addEventListener('click', () => navigateMonths(1));
        document.getElementById('todayBtn').addEventListener('click', goToToday);
        
        // –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –Ω–µ–¥–µ–ª—è–º
        document.getElementById('prevWeek').addEventListener('click', () => navigateWeeks(-1));
        document.getElementById('nextWeek').addEventListener('click', () => navigateWeeks(1));
        
        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∫–ª–∞–¥–æ–∫
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', function() {
                const page = this.getAttribute('data-page');
                switchPage(page);
            });
        });
        
        // –†–µ–∂–∏–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
        document.getElementById('editModeBtn').addEventListener('click', toggleEditMode);
        
        // –í—ã—Ö–æ–¥ –∏–∑ —Å–∏—Å—Ç–µ–º—ã
        document.getElementById('logoutBtn').addEventListener('click', logout);
        
        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å—Ç—É–¥–µ–Ω—Ç–∞
        document.getElementById('addStudentBtn').addEventListener('click', showAddStudentModal);
        
        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Å—Ç—É–¥–µ–Ω—Ç–æ–≤
        document.getElementById('addMultipleStudentsBtn').addEventListener('click', showAddMultipleStudentsModal);
        
        // –§–∏–ª—å—Ç—Ä—ã
        document.getElementById('applyFilterBtn').addEventListener('click', applyFilters);
        document.getElementById('weeklyApplyFilterBtn').addEventListener('click', applyWeeklyFilters);
        
        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–æ—Å–µ—â–∞–µ–º–æ—Å—Ç–∏
        document.getElementById('saveAttendanceBtn').addEventListener('click', saveAllAttendance);
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –ø–æ–ª—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Å—Ç—É–¥–µ–Ω—Ç–æ–≤
        document.getElementById('multipleStudentsNames').addEventListener('input', updateMultipleStudentsPreview);
    }

    // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ WebSocket —Å–ª—É—à–∞—Ç–µ–ª–µ–π (–æ–±–Ω–æ–≤–ª—è–µ–º –¥–ª—è –ø–æ—á–∞—Å–æ–≤–æ–≥–æ —É—á–µ—Ç–∞)
    function setupSocketListeners() {
        socket.on('connect', () => {
            console.log('Connected to server via WebSocket');
            document.getElementById('statusIndicator').className = 'status-indicator';
            document.getElementById('statusText').textContent = '–û–Ω–ª–∞–π–Ω';
        });
        
        socket.on('disconnect', () => {
            console.log('Disconnected from server');
            document.getElementById('statusIndicator').className = 'status-indicator offline';
            document.getElementById('statusText').textContent = '–û—Ñ–ª–∞–π–Ω';
        });
        
        socket.on('attendance_updated', (data) => {
            console.log('Attendance updated via WebSocket:', data);
            
            if (data.hour !== null && data.hour !== undefined) {
                // –ü–æ—á–∞—Å–æ–≤–æ–π —É—á–µ—Ç
                if (!hourlyAttendance[data.date]) {
                    hourlyAttendance[data.date] = {};
                }
                if (!hourlyAttendance[data.date][data.studentId]) {
                    hourlyAttendance[data.date][data.studentId] = {};
                }
                hourlyAttendance[data.date][data.studentId][data.hour] = data.status;
            } else {
                // –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π —É—á–µ—Ç (–¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏)
                if (!attendance[data.date]) {
                    attendance[data.date] = {};
                }
                attendance[data.date][data.studentId] = data.status;
            }
            
            if (formatDate(selectedDate) === data.date) {
                renderStudentsGrid();
            }
            
            if (isDateInCurrentWeek(new Date(data.date))) {
                renderWeeklyTable();
            }
        });
        
        socket.on('student_added', (student) => {
            console.log('Student added via WebSocket:', student);
            
            if (!students.find(s => s.id === student.id)) {
                students.push(student);
                renderStudentsGrid();
                renderWeeklyTable();
                renderStudentsTable();
                updateStats();
            }
        });
        
        socket.on('student_deleted', (studentId) => {
            console.log('Student deleted via WebSocket:', studentId);
            
            students = students.filter(s => s.id !== studentId);
            renderStudentsGrid();
            renderWeeklyTable();
            renderStudentsTable();
            updateStats();
        });
    }

    // ===== –§–£–ù–ö–¶–ò–û–ù–ê–õ–¨–ù–û–°–¢–¨ –ü–†–ò–õ–û–ñ–ï–ù–ò–Ø =====
    // –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –º–µ—Å—è—Ü–∞–º
    function navigateMonths(months) {
        currentDate.setMonth(currentDate.getMonth() + months);
        generateCalendar();
    }

    // –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è—à–Ω—é—é –¥–∞—Ç—É
    function goToToday() {
        selectedDate = new Date();
        currentDate = new Date();
        updateDateDisplay();
        generateCalendar();
        renderStudentsGrid();
    }

    // –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –Ω–µ–¥–µ–ª—è–º
    function navigateWeeks(weeks) {
        currentWeekStart.setDate(currentWeekStart.getDate() + (weeks * 7));
        updateWeekDisplay();
        renderWeeklyTable();
    }

    // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º–∏
    function switchPage(page) {
        document.querySelectorAll('.tab-content').forEach(content => {
            content.classList.remove('active');
        });
        
        document.querySelectorAll('.tab').forEach(tab => {
            tab.classList.remove('active');
        });
        
        document.getElementById(page + 'Page').classList.add('active');
        document.querySelector(`.tab[data-page="${page}"]`).classList.add('active');
    }

    // –í—ã–±–æ—Ä –¥–∞—Ç—ã –≤ –∫–∞–ª–µ–Ω–¥–∞—Ä–µ
    function selectDate(date) {
        selectedDate = date;
        updateDateDisplay();
        renderStudentsGrid();
        generateCalendar();
    }

    // –û—Ç–º–µ—Ç–∫–∞ –ø–æ—Å–µ—â–∞–µ–º–æ—Å—Ç–∏ (–¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏)
    function markAttendance(studentId, status) {
        const dateStr = formatDate(selectedDate);
        saveAttendance(studentId, dateStr, status);
    }

    // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ä–µ–∂–∏–º–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
    function toggleEditMode() {
        editMode = !editMode;
        const editBtn = document.getElementById('editModeBtn');
        
        if (editMode) {
            editBtn.textContent = '‚úèÔ∏è –†–µ–∂–∏–º –ø—Ä–æ—Å–º–æ—Ç—Ä–∞';
            editBtn.classList.remove('btn-warning');
            editBtn.classList.add('btn-success');
            showNotification('–†–µ–∂–∏–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤–∫–ª—é—á–µ–Ω', 'success');
        } else {
            editBtn.textContent = '‚úèÔ∏è –†–µ–∂–∏–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è';
            editBtn.classList.remove('btn-success');
            editBtn.classList.add('btn-warning');
            showNotification('–†–µ–∂–∏–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –æ—Ç–∫–ª—é—á–µ–Ω', 'info');
        }
        
        renderStudentsGrid();
    }

    // –í—ã—Ö–æ–¥ –∏–∑ —Å–∏—Å—Ç–µ–º—ã
    function logout() {
        localStorage.removeItem('currentUser');
        window.location.href = 'index.html';
    }

    // –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–æ–≤
    function applyFilters() {
        renderStudentsGrid();
    }

    function applyWeeklyFilters() {
        renderWeeklyTable();
    }

    // –ü–æ–∫–∞–∑–∞—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Å—Ç—É–¥–µ–Ω—Ç–∞
    function showAddStudentModal() {
        document.getElementById('addStudentModal').classList.add('show');
    }

    // –°–∫—Ä—ã—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Å—Ç—É–¥–µ–Ω—Ç–∞
    function hideAddStudentModal() {
        document.getElementById('addStudentModal').classList.remove('show');
        document.getElementById('studentName').value = '';
        document.getElementById('studentProfession').value = '';
    }

    // –ü–æ–∫–∞–∑–∞—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Å—Ç—É–¥–µ–Ω—Ç–æ–≤
    function showAddMultipleStudentsModal() {
        const professionSelect = document.getElementById('batchProfessionSelect');
        const selectedProfession = professionSelect.value;
        
        if (!selectedProfession) {
            showNotification('–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ—Ñ–µ—Å—Å–∏—é', 'error');
            return;
        }
        
        const professionName = professions.find(p => p.id === selectedProfession)?.name || selectedProfession;
        
        document.getElementById('selectedProfessionName').textContent = professionName;
        document.getElementById('multipleStudentsProfession').value = selectedProfession;
        document.getElementById('multipleStudentsNames').value = '';
        
        updateMultipleStudentsPreview();
        
        document.getElementById('addMultipleStudentsModal').classList.add('show');
    }

    // –°–∫—Ä—ã—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Å—Ç—É–¥–µ–Ω—Ç–æ–≤
    function hideAddMultipleStudentsModal() {
        document.getElementById('addMultipleStudentsModal').classList.remove('show');
    }

    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–µ–≤—å—é —Å—Ç—É–¥–µ–Ω—Ç–æ–≤
    function updateMultipleStudentsPreview() {
        const namesText = document.getElementById('multipleStudentsNames').value;
        const names = namesText.split('\n').filter(name => name.trim() !== '');
        const preview = document.getElementById('multipleStudentsPreview');
        
        preview.innerHTML = '';
        
        if (names.length === 0) {
            preview.innerHTML = '<div class="student-preview-item">–í–≤–µ–¥–∏—Ç–µ –∏–º–µ–Ω–∞ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤</div>';
            return;
        }
        
        if (names.length > 33) {
            preview.innerHTML = '<div class="student-preview-item" style="color: var(--danger);">–ü—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç –≤ 33 —Å—Ç—É–¥–µ–Ω—Ç–∞</div>';
            return;
        }
        
        names.forEach((name, index) => {
            const item = document.createElement('div');
            item.className = 'student-preview-item';
            item.textContent = `${index + 1}. ${name.trim()}`;
            preview.appendChild(item);
        });
    }

    // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Å—Ç—É–¥–µ–Ω—Ç–∞
    async function addNewStudent() {
        const name = document.getElementById('studentName').value.trim();
        const profession = document.getElementById('studentProfession').value;
        
        if (!name) {
            showNotification('–í–≤–µ–¥–∏—Ç–µ –§–ò–û —Å—Ç—É–¥–µ–Ω—Ç–∞', 'error');
            return;
        }
        
        if (!profession) {
            showNotification('–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ—Ñ–µ—Å—Å–∏—é —Å—Ç—É–¥–µ–Ω—Ç–∞', 'error');
            return;
        }
        
        const professionData = professions.find(p => p.id === profession);
        
        const studentData = {
            name: name,
            group: profession,
            course: professionData.course
        };
        
        const success = await addStudent(studentData);
        if (success) {
            hideAddStudentModal();
        }
    }

    // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Å—Ç—É–¥–µ–Ω—Ç–æ–≤
    async function addMultipleStudents() {
        const namesText = document.getElementById('multipleStudentsNames').value;
        const profession = document.getElementById('multipleStudentsProfession').value;
        
        if (!namesText.trim()) {
            showNotification('–í–≤–µ–¥–∏—Ç–µ –∏–º–µ–Ω–∞ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤', 'error');
            return;
        }
        
        const names = namesText.split('\n')
            .filter(name => name.trim() !== '')
            .slice(0, 33);
        
        if (names.length === 0) {
            showNotification('–í–≤–µ–¥–∏—Ç–µ –∏–º–µ–Ω–∞ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤', 'error');
            return;
        }
        
        const professionData = professions.find(p => p.id === profession);
        if (!professionData) {
            showNotification('–û—à–∏–±–∫–∞: –ø—Ä–æ—Ñ–µ—Å—Å–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞', 'error');
            return;
        }
        
        const studentsList = names.map(name => ({
            name: name.trim(),
            group: profession,
            course: professionData.course
        }));
        
        console.log('Attempting to add students:', studentsList);
        
        const success = await addMultipleStudents(studentsList);
        if (success) {
            hideAddMultipleStudentsModal();
        }
    }

    // –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
    function startDataRefresh() {
        dataRefreshInterval = setInterval(async () => {
            await loadStudents();
            await loadAttendance();
        }, 5000); // –û–±–Ω–æ–≤–ª—è–µ–º –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥
    }

    // ===== –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò =====
    // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞—Ç—ã –≤ —Å—Ç—Ä–æ–∫—É YYYY-MM-DD
    function formatDate(date) {
        const year = date.getFullYear();
        const month = String(date.getMonth() + 1).padStart(2, '0');
        const day = String(date.getDate()).padStart(2, '0');
        return `${year}-${month}-${day}`;
    }

    // –ü—Ä–æ–≤–µ—Ä–∫–∞, –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –ª–∏ –¥–∞—Ç–∞ –≤ —Ç–µ–∫—É—â–µ–π –Ω–µ–¥–µ–ª–µ
    function isDateInCurrentWeek(date) {
        const weekEnd = new Date(currentWeekStart);
        weekEnd.setDate(currentWeekStart.getDate() + 6);
        
        return date >= currentWeekStart && date <= weekEnd;
    }

    // –ü–æ–∫–∞–∑–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
    function showNotification(message, type = 'info') {
        const notification = document.getElementById('notification');
        notification.textContent = message;
        notification.className = `notification ${type}`;
        notification.classList.add('show');
        
        setTimeout(() => {
            notification.classList.remove('show');
        }, 3000);
    }
</script>
</body>
</html>
